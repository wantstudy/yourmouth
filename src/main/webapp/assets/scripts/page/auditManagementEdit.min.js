(function(){top.App.toggleSidebarStatus(true);var c=$("#baseInfo"),j=$("#modifySchoolTable"),q=$("#imgs"),p=$("#userImages"),k=$("#mailList"),u=$("#dialNumber"),n=$("#receiveState"),e=$("#nuclearRecord"),h=$("#nuclearRecordTitle"),f=$("#checkSelect"),g=$("#checkAppend"),i=$("#txList"),o=$("#phoneCheck"),l=$("#nuclearRecordWrap"),t=$("#nuclearReportWrap"),a=$("#faceCheckBtn"),d=$("#auditcommitForm"),r=$("#checkAgainData"),b=$("#xuexinScore"),m=$(".triggerRuleWrap");var s={init:function(A){if(A.data.incomeId==null){var E="";var z=false;if(this.getQuery()["comefrom"]=="search"){z=true;E="该进件状态已经改变，请重新查询！"}else{E="触发进件规则，进件被拒绝！"}top.art.dialog({title:"提示",fixed:true,height:100,width:200,padding:10,content:E,lock:true,button:[{value:"确 定",callback:function(){if(z){Qhistory.goback()}else{location.href="modules/auditManagement/list.html"}return true}}]});return false}var A=A.data;if(this.getQuery()["userAction"]=="no"){$("#reCheck").hide()}else{window.localStorage.setItem(A.incomeId,1);d.find("textarea").val(window.localStorage.getItem(A.incomeId+"_save"));$("#reCheck").click(function(){top.art.dialog({title:"重新验证吗？",fixed:true,width:300,height:50,content:"你确定要重新验证吗?",okValue:"确定",cancelValue:"取消",lock:true,ok:function(){util.ajax.ajax({type:"post",data:{incomeId:A.incomeId,userId:A.userId,userCardNo:A.userCardNo,userName:A.userName,faceIdentifyPic:A.faceIdentifyPic},url:"pep/haixincheck.htmls",success:function(G){top.App.notice("验证成功","success","top-center");util.ajax.ajax({url:"pep/perinfo.htmls",data:util.url.getQuery(),success:function(H){if(H.result==0){x(H.data)}}})}});return true},cancel:function(){return true}})})}k.find("div.scroller").slimScroll({size:"10px",color:"#a1b2bd",opacity:0.5,position:"right",height:300,allowPageScroll:false,disableFadeOut:false});if(this.getQuery()["userAction"]=="no"){$("#modifySchoolBtn,#phoneCheck,#auditcommitForm,#panel-c .user-action").hide()}$baseTds=c.find("td"),$schoolTds=j.find("td"),q=q;var C=$("#htmlTmp select.education");util.ajax.ajax({type:"post",url:C.data("ajax"),success:function(G){if(G.result==0){var H="";$.each(G.data.list,function(I,J){H+='<option value="'+J.id+'">'+J.name+"</option>"});C.append(H);$.each(C.find("option"),function(I,J){if($.trim($(J).val())==A.educationalLevel){$(J).attr("selected",true)}})}}});$("input[name=incomeId]").val(A.incomeId);$("input[name=userId]").val(A.userId);$("input[name=userCardNo]").val(A.userCardNo);$("input[name=userName]").val(A.userName);$("input[name=faceIdentifyPic]").val(A.faceIdentifyPic);$("input[name=educationalLevel]").val(A.educationalLevel);$("input[name=inschoolTime]").val(A.inschoolTime);$("input[name=graduateYear]").val(A.graduateYear);$("input[name=schoolName]").val(A.schoolName);$("input[name=schoolId]").val(A.schoolId);$("input[name=cityCode]").val(A.cityCode);$("input[name=cityName]").val(A.cityName);$baseTds.eq(1).html(A.incomeId);$baseTds.eq(3).html(A.userId);$baseTds.eq(5).html(A.incomeDateStr);$baseTds.eq(7).html(A.userName);$baseTds.eq(9).html(A.userCardNo);$baseTds.eq(11).html(A.phoneNo);$baseTds.eq(13).html(A.emergencyPerson?A.emergencyPerson:"无");$baseTds.eq(15).html(A.emergencyPhone?A.emergencyPhone:"无");$baseTds.eq(17).html(A.referrerCode?A.referrerCode:"无");var y={10:"自动审核中",13:"初审待分配",14:"初审审核中",15:"预通过待分配",16:"预通过审核中",44:"最终拒绝",41:"拒绝",23:"最终通过",22:"通过",21:"预通过",25:"冻结"};$baseTds.eq(19).html(y[A.incomeState]);var B={1:"渠道",2:"自己注册",3:"喵卡支付"};$baseTds.eq(21).html(B[A.origin]);A.xuexinResult.xuexinResult=A.xuexinResult.xuexinResult||"";if(A.xuexinResult.xuexinResult==""){b.children("span").html("学信网未验证")}else{if(A.xuexinResult.xuexinResultScore==null||A.xuexinResult.xuexinResultScore==""||A.xuexinResult.xuexinResultScore=="-1"){b.children("span").html("学信网检测异常")}else{b.children("span").html(A.xuexinResult.xuexinResultScore)}}$schoolTds.eq(1).html(A.cityName).data("text",A.cityName);$schoolTds.eq(3).html(A.schoolName).data("text",A.schoolName);var v=["专科","本科","硕士","博士"][A.educationalLevel];$schoolTds.eq(5).html(v).data("text",v);$schoolTds.eq(7).html(A.inschoolTime).data("text",A.inschoolTime);$schoolTds.eq(9).html(A.graduateYear).data("text",A.graduateYear);$schoolTds.eq(11).html(A.inschoolAge).data("text",A.inschoolAge);this.checkResultRender(A.xuexinResult);if(A.xuexinResult.xuexinResultScore=="-1"){$("#modifySchoolTable span").hide()}var x=(function(G){if(G.senstimeResult){q.find("td.t").html("senstime人脸识别");if(G.senstimeResult.result==1){q.find("td.a").html("通过")}else{if(G.senstimeResult.result==2){q.find("td.a").html("拒绝")}else{if(G.senstimeResult.result==3){q.find("td.a").html("人工")}}}q.find("td.b").html(G.senstimeResult.thirdPartyValue);return}q.find("td.t").html("海鑫人脸识别");q.find("td.a").html(G.haixinResult.haixinResult);q.find("td.b").html(G.haixinResult.haixinScore)});x(A);var D=[{title:"海鑫",src:A.faceIdentifyPic},{title:"身份证正面",src:A.idcardAPic},{title:"手持身份证正面",src:A.handPic},{title:"其它图片",src:A.otherPic1},{title:"其它图片",src:A.otherPic2},{title:"其它图片",src:A.otherPic3}];$.each(D,function(H,I){if(I.src){var G='<li><a href="javascript:void(0)" rel="lightbox-group" title="'+I.title+'"><img src="'+I.src+'" id="i'+(H+1)+'"></a><p>'+I.title+"</p></li>";p.append(G)}});this.faceCheck(A);var F=A.addressBooks?A.addressBooks:[],w="";k.find(".sub-title span").html(F.length);$.each(F,function(G,H){w+="<tr><td>"+H.relName+"</td><td>"+H.relPhone+"</td></tr>"});k.find("table").append(w);i.find("button").on("click",function(H){var G=i.serialize();util.ajax.ajax({url:i.data("ajax"),data:G,success:function(J){if(J.result==0){if(J.data.list){var I="";$.each(J.data.list,function(K,L){I+="<tr><td>"+L.relName+"</td><td>"+L.relPhone+"</td></tr>"});k.find("table tr:gt(0)").remove();k.find("table").append(I);k.find(".error-tips").html("");k.find(".sub-title span").html(J.data.list.length)}else{k.find("table tr:gt(0)").remove();k.find(".error-tips").html("暂无数据");k.find(".sub-title span").html(0)}}}});H.preventDefault()});this.rightInfo(A);this.topShowImgs();this.qBaseInit();this.triggerRule(A)},triggerRule:function(v){util.ajax.ajax({url:m.data("ajax"),data:"incomeId="+v.incomeId,success:function(x){var B="triggerRuleMap";var w="allRuleMap";var A=x.data;var z=[];for(var y in A[B]){var C=A[B][y];z.push("<tr><td>"+(parseInt(y)+1)+"."+C.name+'&nbsp;&nbsp;<span class="alert-danger">'+({"1":"通过"}[C.result]||"不通过")+"</span></td></tr>")}$("."+B+" tbody").html(z.join("\n"));z=[];for(var y in A[w]){var C=A[w][y];z.push("<tr><td>"+(parseInt(y)+1)+"."+C.name+'&nbsp;&nbsp;<span class="alert-danger">'+({"1":"通过"}[C.result]||"不通过")+"</span></td></tr>")}$("."+w+" tbody").html(z.join("\n"))}})},faceCheck:function(v){a.on("click",function(){var w=$(this).parent().children("form");util.ajax.ajax({url:w.data("ajax"),data:w.serialize(),success:function(x){if(x.result==0){a.parents("tr").find("td:eq(1)").html(x.haixinScore);top.App.notice("检测成功","success","top-center")}}})})},rightInfo:function(x){var z=this,w=x.select.dailNumber?x.select.dailNumber:[],y=x.select.receiveState?x.select.receiveState:[],v=receiveStateListTmp="";$.each(w,function(A,B){v+='<option value="'+B+'">'+B+"</option>"});$.each(y,function(A,B){receiveStateListTmp+='<option value="'+B+'">'+B+"</option>"});u.append(v);n.append(receiveStateListTmp);this.nuclearRecord(x);o.find("button").on("click",function(A){if(!$.trim(u.val())){top.App.notice("请选择拨打号码","warning","top-right");return false}else{if(!$.trim(n.val())){top.App.notice("请选择接听状态","warning","top-right");return false}else{if(!$.trim(o.find("textarea").val())){top.App.notice("请填写电核日志","warning","top-right");return false}}}util.ajax.ajax({url:o.data("ajax"),data:o.serialize(),success:function(B){if(B.result==0){z.phoneRecordInit(B,"ajax");top.App.notice("保存成功","success","top-right");o[0].reset()}}});A.preventDefault()});this.policyDecision(x)},getQuery:function(){return util.url.getQuery()},policyDecision:function(x){var z=this,v=x.select.decision?x.select.decision:[],w="";$.each(v,function(A,B){w+='<option value="'+B.status+'">'+B.sName+"</option>"});f.append(w).on("change",function(){var D=$(this).val(),B=null,A="";if(D==21){var C=";";if(z.getQuery()["tolockdecision"]=="21"){C='readonly="readonly"'}B=$('<input type="text" '+C+' maxlength="5" class="changeMoney" name="changeMoney" value="'+v["21"]["value"]+'" />')}else{if(D==22){B=$('<input type="text" maxlength="5" class="changeMoney" name="changeMoney" value="'+v["22"]["value"]+'" />')}else{if(D==23){B=$('<input type="text" maxlength="5" class="changeMoney" name="changeMoney" value="'+v["23"]["value"]+'" />')}else{if(D==41){B=$('<select name="refuseNo" id="refuseNo"><option value="">请选择</option></select>');$.each(v["41"]["value"],function(E,F){A+='<option value="'+E+'">'+F+"</option>"});B.append(A)}else{if(D==44){B=$('<select name="refuseNo" id="refuseNo"><option value="">请选择</option></select>');$.each(v["44"]["value"],function(E,F){A+='<option value="'+E+'">'+F+"</option>"});B.append(A)}}}}}g.html(B)});d.delegate(".changeMoney","keyup",function(){var C=$(this).val(),B=/^\d+$/ig,A=/\d+/ig;if(!B.test(C)){$(this).val(C.match(A)?C.match(A)[0]:"")}});var y=d.find("textarea");d.find(".btn-danger").on("click",function(A){if(y.val()!=""){window.localStorage.setItem(x.incomeId+"_save",y.val());top.App.notice("暂存成功，请尽快处理，如浏览器清除缓存，暂存数据也会被删除！且行且珍惜！","warning","bottom-right",8)}});d.find("button.btn-info").on("click",function(C){var B=this;if(!$.trim(y.val())){top.App.notice("请填写报告内容！","warning","bottom-right");return false}if(!$.trim(f.val())){top.App.notice("请选择决策！","warning","bottom-right");return false}var D=d.find(".changeMoney");if(D.length){if(!$.trim(D.val())||$.trim(D.val())==0){top.App.notice("金额不能为空，并且为大于0的数字！","warning","bottom-right");return false}}var A=d.find("#refuseNo");if(A.length){if(!$.trim(A.val())){top.App.notice("请选择拒绝理由！","warning","bottom-right");return false}}util.ajax.ajax({url:d.data("ajax"),data:d.serialize(),success:function(E){if(E.result==0){z.reportInit(E,"ajax");top.App.notice("添加报告成功！","success","top-center");d[0].reset();d.find("textarea,select,input,button.btn-info").attr("disabled",true);d.find("button.btn-danger").remove();$(B).removeClass("btn-info").addClass("blackBt");if(z.getQuery()["from"]=="1"){location.href="list.html?reload=1"}else{location.href="pre_list.html?reload=1"}}}});C.preventDefault()})},qBaseInit:function(){var v=this;Qpage.edit.main({v_selector:function(){return this.parent()+",[data-type=edit]|tdEdits,#userImages img|imgs"},v_eventBindType:function(){return this.parent()+" mouseover mouseout mouseenter mouseleave"},p_imgs_click:function(x,w){var y=w[0].id;top.$("#"+y).trigger("click")},p_tdEdits_mouseover:function(x,w){w.find("span").css({filter:"Alpha(Opacity=100)",opacity:1})},p_tdEdits_mouseout:function(x,w){w.find("span").css({filter:"Alpha(Opacity=0)",opacity:0})},p_modifySchoolBtn_click:function(A,y){var w=$("#htmlTmp").html(),x=null;var z=top.art.dialog({title:"修改学籍信息",fixed:true,width:600,padding:10,content:w,okValue:"提交并检测",cancelValue:"取消",lock:true,initialize:function(){$("#modifySchoolTable td[class]").each(function(B,C){top.$("#modifySchoolForm").find("."+$(C).attr("class")).val($.trim($(C).data("text")))});top.M$("citySchoolSuggest",function(){top.citySuggest();top.schoolSuggest();var C=top.$(".layer-begin-time"),D=top.$(".layer-end-time"),B={format:"yyyy",language:"zh-CN",autoclose:1,minView:4,startView:4,startDate:"2005",endDate:"2020"};C.datetimepicker(B).on("changeDate",function(G){var E=G.date.valueOf(),H=new Date();H.setTime(E);var F=(H.getFullYear()+1)+"-"+(H.getMonth()+1)+"-"+H.getDate();D.attr("disabled",false).datetimepicker("remove").val("").datetimepicker({format:"yyyy",language:"zh-CN",autoclose:1,minView:4,startDate:F,startView:4,endDate:"2020"}).focus()});x=setInterval(function(){top.$(".datetimepicker .table-condensed").css({width:230}).find(".prev").html("&lt;").css("color","#999").end().find(".next").html("&gt;").css("color","#999")},50)})},ok:function(){clearInterval(x);var B=true,C=top.$("#modifySchoolForm");$.each(top.$("#modifySchoolForm").find("input:visible"),function(D,E){if(!$.trim($(E).val())){top.$("#modifySchoolForm").find(".tips").css({color:"#f00"});B=false;return false}});if(!$.trim(C.find("select.education").val())){top.$("#modifySchoolForm").find(".tips").css({color:"#f00"});B=false;return false}if(B){r.find("input[name=educationalLevel]").val(C.find(".education").val());r.find("input[name=inschoolTime]").val(C.find(".entranceTime").val());r.find("input[name=graduateYear]").val(C.find(".graduationTime").val());r.find("input[name=cityName]").val(C.find(".city").val());r.find("input[name=schoolName]").val(C.find(".name").val());if(C.find("#schoolId").length&&$.trim(C.find("#schoolId").val())){r.find("input[name=schoolId]").val(C.find("#schoolId").val())}if(C.find("#cityId").length&&$.trim(C.find("#cityId").val())){r.find("input[name=cityCode]").val(C.find("#cityId").val())}C.parents(".d-inner").find(".d-state-highlight").attr("disabled","disabled");util.ajax.ajax({url:r.data("ajax"),data:r.serialize(),success:function(D){if(D.result==0){var E=D.data;top.App.notice("修改成功","success","top-center");z.close();location.reload()}},error:function(D){z.close();top.App.notice(D,"error","top-center")}});return false}else{return false}},cancel:function(){clearInterval(x);return true}});A.preventDefault()},p_tdEdits_click:function(y,x){var z=$.trim(x.html()),w=$.trim(x.data("class"))}})},checkResultRender:function(y){var w='<span class="fa fa-times-circle"></span>',x='<span class="fa fa-check-circle"></span>',v='<span class="fa fa-question-circle"></span>';j.find("td span").remove();if(y.idcardResult=="N"){$("#userNoTips").append(w)}if(y.inschoolTimeResult=="T"){j.find("td.entranceTime").append(x)}else{if(y.inschoolTimeResult=="F"){j.find("td.entranceTime").append(w)}else{if(y.inschoolTimeResult=="U"){j.find("td.entranceTime").append(v)}}}if(y.collegeNameResult=="T"){j.find("td.name").append(x)}else{if(y.collegeNameResult=="F"){j.find("td.name").append(w)}else{if(y.collegeNameResult=="U"){j.find("td.name").append(v)}}}if(y.educationalLevelResult=="T"){j.find("td#educationalLevelTips").append(x)}else{if(y.collegeNameResult=="F"){j.find("td#educationalLevelTips").append(w)}else{if(y.collegeNameResult=="U"){j.find("td#educationalLevelTips").append(v)}}}},phoneRecordInit:function(y,w){if(w=="init"){var x=y.nuclearRecord?y.nuclearRecord:[]}else{if(w=="ajax"){var x=y.data.list?y.data.list:[]}}var v="",z=$('<table class="table table-bordered table-hover" id="nuclearRecord">									<tr>										<td width="30" style="background: #ececec;">序号</td>										<td width="120" style="background: #ececec;">时间</td>										<td width="60" style="background: #ececec;">操作员</td>										<td style="background: #ececec;">拨打号码</td>										<td width="70" style="background: #ececec;">接听状态</td>										<td width="60" style="background: #ececec;">电核日志</td>									</tr>								</table>');if(x.length){$.each(x,function(A,B){v+="<tr><td>"+(A+1)+"</td><td>"+B.phoneDate+"</td><td>"+B.operateName+"</td><td>"+B.phoneNo+"</td><td>"+B.status+'</td><td><a class="detailBtn" style="cursor:pointer;">查看</a></td></tr><tr class="hide"><td colspan="6">'+B.auditDialog+"</td></tr>"})}else{v='<tr><td colspan="6" style="text-align:center;">暂无数据</td></tr>'}z.append(v);l.html(z)},reportInit:function(x,w){if(w=="init"){var z=x.reportList?x.reportList:[]}else{if(w=="ajax"){var z=x.data.list?x.data.list:[]}}var v="",y=$('<table class="table table-bordered table-hover" id="nuclearRecord">										<tr>											<td width="30" style="background: #ececec;">序号</td>											<td width="120" style="background: #ececec;">时间</td>											<td width="60" style="background: #ececec;">姓名</td>											<td style="background: #ececec;">授信金额</td>											<td style="background: #ececec;">决策结果</td>											<td style="background: #ececec;">拒绝码</td>											<td width="70" style="background: #ececec;">内容</td>										</tr>									</table>');if(z.length){$.each(z,function(A,C){var B=C.changeMoney||0;B=(B/100).toFixed(2);v+="<tr><td>"+(A+1)+"</td><td>"+C.reportDate+"</td><td>"+C.operateName+"</td><td>"+B+"</td><td>"+C.decision+"</td><td>"+(C.refuseNo||"")+'</td><td><a class="detailBtn" style="cursor:pointer;">查看</a></td></tr><tr class="hide"><td colspan="7">'+C.context+"</td></tr>"})}else{v='<tr><td colspan="7" style="text-align:center;">暂无数据</td></tr>'}y.append(v);t.html(y)},nuclearRecord:function(w){var v=this.getQuery()["status"];this.phoneRecordInit(w,"init");this.reportInit(w,"init");$("#nuclearReportWrap,#nuclearRecordWrap").delegate("a.detailBtn","click",function(y){var x=$(this).parents("tr").next();x.toggle();if(x.is(":visible")){$(this).html("关闭")}else{$(this).html("查看")}y.preventDefault()})},ajaxGetData:function(){var v=this;util.ajax.ajax({url:"pep/perinfo.htmls",data:v.getQuery(),success:function(w){if(w.result==0){v.init(w)}}})},topShowImgs:function(){if(top.$("#userImages").length){top.$("#userImages").remove()}var v=p.clone();$.each(v.find("a"),function(w,x){$(x).attr("href",$(x).find("img").attr("src"))});top.$("body").append(v);top.$("a[rel^='lightbox']").picbox({},null,function(w){return(this==w)||((this.rel.length>8)&&(this.rel==w.rel))});p.children("img").on("click",function(){var w=this.id;top.$("#"+w).trigger("click")})}};s.ajaxGetData()})();